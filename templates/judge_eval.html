<!DOCTYPE html>
<html>
	<head>
		<title>Judge Panel</title>
		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<!-- jquery-modal -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

		<!-- CSS for Modals and Cards -->
		<style>
			.modal {
				position: relative;
				width: 90%;
				max-width: 600px;
				margin: auto;
				padding: 20px;
				background-color: white;
				border-radius: 8px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
				overflow-y: auto; 
				max-height: 90vh; 
			}

			.modal .modal-close {
				position: absolute;
				bottom: 10px;
				right: 10px; 
				background-color: #ccc;
				color: black;
				border: none;
				padding: 8px 16px;
				cursor: pointer;
				border-radius: 4px;
				font-size: 14px;
				transition: background-color 0.3s;
			}

			.modal .modal-close:hover {
				background-color: #aaa;
			}

			.modal input[type="text"],
			.modal textarea,
			.modal input[type="number"] {
				width: 100%;
				box-sizing: border-box; 
				margin-bottom: 10px;
			}

			@media (max-width: 768px) {
				.modal {
					width: 90%;
				}
			}

			.poster-box {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				align-items: flex-start;
				padding: 10px;
				border: 1px solid #ccc;
				border-radius: 8px;
				background-color: #f9f9f9;
				box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
				width: calc(100%-10px);
				min-height: 100px;
				word-wrap: break-word;
				overflow: hidden;
				transition: transform 0.2s, box-shadow 0.2s;
			}

			.poster-box:hover {
				transform: scale(0.95);
				box-shadow: 0px 6px 8px rgba(0, 0, 0, 0.2);
			}

			.poster-box p {
				margin: 0;
				padding: 5px 0;
			}

			.poster-box p {
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}

			.poster-box.multiline p {
				white-space: normal;
				text-overflow: clip;
			}

			.pagination {
			margin-top: 20px;
			text-align: center;
		}

		.pagination a {
			display: inline-block;
			margin: 0 5px;
			padding: 8px 12px;
			background-color: #f1f1f1;
			color: #333;
			text-decoration: none;
			border-radius: 4px;
		}

		.pagination a.active {
			background-color: #007bff;
			color: #fff;
		}

		.pagination a:hover {
			background-color: #ddd;
		}

		.pagination-link {
			display: inline-block;
			padding: 8px 16px;
			margin: 0 5px;
			text-decoration: none;
			color: #007bff;
			border: 1px solid #ddd;
			border-radius: 4px;
			transition: background-color 0.3s, color 0.3s;
		}

		.pagination-link:hover {
			background-color: #f1f1f1;
			color: #0056b3;
		}

		.pagination-link.active {
			background-color: #007bff;
			color: #fff;
			border-color: #007bff;
			pointer-events: none; 
		}

		.scroll-to-top {
			position: fixed;
			bottom: 70px;
			right: 20px;
			width: 50px;
			height: 50px;
			background-color: #007bff;
			color: white;
			font-size: 24px;
			text-align: center;
			line-height: 50px;
			border-radius: 50%;
			cursor: pointer;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			transition: opacity 0.3s, transform 0.3s;
		}

		.scroll-to-top:hover {
			background-color: #0056b3;
			transform: scale(1.1);
		}

		.scroll-to-btm {
			position: fixed;
			bottom: 20px;
			right: 20px;
			width: 50px;
			height: 50px;
			background-color: #007bff;
			color: white;
			font-size: 24px;
			text-align: center;
			line-height: 50px;
			border-radius: 50%;
			cursor: pointer;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			transition: opacity 0.3s, transform 0.3s;
		}

		.scroll-to-btm:hover {
			background-color: #0056b3;
			transform: scale(1.1);
		}

		.button01 {
			background-color: #2f4f4f;
			color: #fff;
			padding: 10px 30px;
			text-decoration: none;
			font-size: 1em;
			}
			.button01:hover {
			color: #fff;
			opacity: 0.8;
			}

			@media (max-width: 768px) {
				.poster-box {
					width: 100%;
				}
			}
		</style>
	</head>

	<body>
		<h1>Welcome, {{ judge.name }}</h1>

		{% if message %}
		<p style="color: green;">{{ message }}</p>
		{% endif %}

		<h2>Go to Selection</h2>
		<a href="/judge/{{ token }}">Go to Evaluation</a>
		
		<!-- Selected Posters -->
		<h2>Your Selected Posters</h2>
		{% for poster in selected_posters %}
			<div class="poster-box" onclick="openModal('modal-{{ poster.id }}')">
				<p><strong>{{ poster.number }}</strong></p>
				<p>{{ poster.presenter }}</p>
				<p>{{ poster.title }}</p>
			</div>

			<!-- Deselect modal -->
			<div id="modal-{{ poster.id }}" class="modal">
				<h2>{{ poster.title }}</h2>
				<p><strong>Presenter:</strong> {{ poster.presenter }}</p>
				<p><strong>Abstract:</strong> {{ poster.abstract }}</p>
				<form method="POST">
                    <input type="hidden" name="action" value="rate">
                    <input type="hidden" name="poster_id" value="{{ poster.id }}">
                    
                    <label for="score-{{ poster.id }}">Score (1-10):</label>
                    <input type="number" id="score-{{ poster.id }}" name="score" min="1" max="10" required>
                    
                    <button type="submit">Submit Rating</button>
                </form>
				<button class="modal-close">Close</button>
			</div>
		{% else %}
			<p>No posters selected.</p>
		{% endfor %}
		
		<!-- Logout -->
		<a href="/judge_logout" class="button01">Logout</a>

		<!-- JavaScript -->
		<script>
			// モーダルを開く
			function openModal(modalId) {
				$('#' + modalId).modal(); // モーダルを表示
			}

			// モーダルを閉じる
			$(document).on('click', '.modal-close', function () {
				$.modal.close(); // モーダルを閉じる
			});

			window.addEventListener('load', function () {
				const hash = location.hash;
				if (hash) {
					const element = document.querySelector(hash);
					if (element) {
						element.scrollIntoView({ behavior: 'smooth', block: 'start' });
					}
				}
			});

			document.querySelectorAll('.pagination-link').forEach(link => {
				link.addEventListener('click', function () {
					const targetId = 'available-posters'; // ターゲットのIDを指定
					location.hash = targetId; // ページ遷移後にスクロール
				});
			});
			
			document.addEventListener("DOMContentLoaded", function () {
				const paginationLinks = document.querySelectorAll(".pagination-link");
				const scrollToTopButton = document.getElementById("scroll-to-top");
				const scrollToBtmButton = document.getElementById("scroll-to-btm");

				paginationLinks.forEach(link => {
					link.addEventListener("click", function (e) {
						// 現在のスクロール位置を取得
						const scrollPosition = window.scrollY;

						// スクロール位置をローカルストレージに保存
						localStorage.setItem("scrollPosition", scrollPosition);
					});
				});

				// ページ読み込み後にスクロール位置を復元
				const savedScrollPosition = localStorage.getItem("scrollPosition");
				if (savedScrollPosition !== null) {
					window.scrollTo(0, parseInt(savedScrollPosition, 10));

					// 一度スクロール位置を復元したらリセット
					localStorage.removeItem("scrollPosition");
				}

				scrollToTopButton.addEventListener("click", function () {
					window.scrollTo({
						top: 0,
						behavior: "smooth"
					});
				});

				scrollToBtmButton.addEventListener("click", function () {
					window.scrollTo({
						top: document.body.scrollHeight,
						behavior: "smooth"
					});
				});
			});
		</script>
	</body>
</html>
